!function(e,t){function i(){this._events=new Object}function s(e){e&&(e.delimiter&&(this.delimiter=e.delimiter),e.wildcard&&(this.wildcard=e.wildcard),this.wildcard&&(this.listenerTree=new Object))}function o(e){this._events=new Object,s.call(this,e)}function u(e,t,n,r){if(!n)return[];var i=[],s,o,a,f,l,c,h,p=t.length,d=t[r],v=t[r+1];if(r===p&&n._listeners){if(typeof n._listeners=="function")return e&&e.push(n._listeners),[n];for(s=0,o=n._listeners.length;s<o;s++)e&&e.push(n._listeners[s]);return[n]}if(d==="*"||d==="**"||n[d]){if(d==="*"){for(a in n)a!=="_listeners"&&n.hasOwnProperty(a)&&(i=i.concat(u(e,t,n[a],r+1)));return i}if(d==="**"){h=r+1===p||r+2===p&&v==="*",h&&n._listeners&&(i=i.concat(u(e,t,n,p)));for(a in n)a!=="_listeners"&&n.hasOwnProperty(a)&&(a==="*"||a==="**"?(n[a]._listeners&&!h&&(i=i.concat(u(e,t,n[a],p))),i=i.concat(u(e,t,n[a],r))):a===v?i=i.concat(u(e,t,n[a],r+2)):i=i.concat(u(e,t,n[a],r)));return i}i=i.concat(u(e,t,n[d],r+1))}f=n["*"],f&&u(e,t,f,r+1),l=n["**"];if(l)if(r<p){l._listeners&&u(e,t,l,p);for(a in l)a!=="_listeners"&&l.hasOwnProperty(a)&&(a===v?u(e,t,l[a],r+2):a===d?u(e,t,l[a],r+1):(c={},c[a]=l[a],u(e,t,{"**":c},r+1)))}else l._listeners?u(e,t,l,p):l["*"]&&l["*"]._listeners&&u(e,t,l["*"],p);return i}function a(e,t){e=typeof e=="string"?e.split(this.delimiter):e.slice();for(var i=0,s=e.length;i+1<s;i++)if(e[i]==="**"&&e[i+1]==="**")return;var o=this.listenerTree,u=e.shift();while(u){o[u]||(o[u]=new Object),o=o[u];if(e.length===0){if(!o._listeners)o._listeners=t;else if(typeof o._listeners=="function")o._listeners=[o._listeners,t];else if(n(o._listeners)){o._listeners.push(t);if(!o._listeners.warned){var a=r;typeof this._events.maxListeners!="undefined"&&(a=this._events.maxListeners),a>0&&o._listeners.length>a&&(o._listeners.warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",o._listeners.length),console.trace())}}return!0}u=e.shift()}return!0}var n=Array.isArray?Array.isArray:function(t){return Object.prototype.toString.call(t)==="[object Array]"},r=10;o.prototype.delimiter=".",o.prototype.setMaxListeners=function(e){this._events||i.call(this),this._events.maxListeners=e},o.prototype.event="",o.prototype.once=function(e,t){return this.many(e,1,t),this},o.prototype.many=function(e,t,n){function i(){--t===0&&r.off(e,i),n.apply(this,arguments)}var r=this;if(typeof n!="function")throw new Error("many only accepts instances of Function");return i._origin=n,this.on(e,i),r},o.prototype.emit=function(){this._events||i.call(this);var e=arguments[0];if(e==="newListener"&&!this._events.newListener)return!1;if(this._all){var t=arguments.length,n=new Array(t-1);for(var r=1;r<t;r++)n[r-1]=arguments[r];for(r=0,t=this._all.length;r<t;r++)this.event=e,this._all[r].apply(this,n)}if(e==="error"&&!this._all&&!this._events.error&&(!this.wildcard||!this.listenerTree.error))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");var s;if(this.wildcard){s=[];var o=typeof e=="string"?e.split(this.delimiter):e.slice();u.call(this,s,o,this.listenerTree,0)}else s=this._events[e];if(typeof s=="function"){this.event=e;if(arguments.length===1)s.call(this);else if(arguments.length>1)switch(arguments.length){case 2:s.call(this,arguments[1]);break;case 3:s.call(this,arguments[1],arguments[2]);break;default:var t=arguments.length,n=new Array(t-1);for(var r=1;r<t;r++)n[r-1]=arguments[r];s.apply(this,n)}return!0}if(s){var t=arguments.length,n=new Array(t-1);for(var r=1;r<t;r++)n[r-1]=arguments[r];var a=s.slice();for(var r=0,t=a.length;r<t;r++)this.event=e,a[r].apply(this,n);return a.length>0||this._all}return this._all},o.prototype.on=function(e,t){if(typeof e=="function")return this.onAny(e),this;if(typeof t!="function")throw new Error("on only accepts instances of Function");this._events||i.call(this),this.emit("newListener",e,t);if(this.wildcard)return a.call(this,e,t),this;if(!this._events[e])this._events[e]=t;else if(typeof this._events[e]=="function")this._events[e]=[this._events[e],t];else if(n(this._events[e])){this._events[e].push(t);if(!this._events[e].warned){var s=r;typeof this._events.maxListeners!="undefined"&&(s=this._events.maxListeners),s>0&&this._events[e].length>s&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),console.trace())}}return this},o.prototype.onAny=function(e){this._all||(this._all=[]);if(typeof e!="function")throw new Error("onAny only accepts instances of Function");return this._all.push(e),this},o.prototype.addListener=o.prototype.on,o.prototype.off=function(e,t){if(typeof t!="function")throw new Error("removeListener only takes instances of Function");var r,i=[];if(this.wildcard){var s=typeof e=="string"?e.split(this.delimiter):e.slice();i=u.call(this,null,s,this.listenerTree,0)}else{if(!this._events[e])return this;r=this._events[e],i.push({_listeners:r})}for(var o=0;o<i.length;o++){var a=i[o];r=a._listeners;if(n(r)){var f=-1;for(var l=0,c=r.length;l<c;l++)if(r[l]===t||r[l].listener&&r[l].listener===t||r[l]._origin&&r[l]._origin===t){f=l;break}if(f<0)return this;this.wildcard?a._listeners.splice(f,1):this._events[e].splice(f,1),r.length===0&&(this.wildcard?delete a._listeners:delete this._events[e])}else if(r===t||r.listener&&r.listener===t||r._origin&&r._origin===t)this.wildcard?delete a._listeners:delete this._events[e]}return this},o.prototype.offAny=function(e){var t=0,n=0,r;if(e&&this._all&&this._all.length>0){r=this._all;for(t=0,n=r.length;t<n;t++)if(e===r[t])return r.splice(t,1),this}else this._all=[];return this},o.prototype.removeListener=o.prototype.off,o.prototype.removeAllListeners=function(e){if(arguments.length===0)return!this._events||i.call(this),this;if(this.wildcard){var t=typeof e=="string"?e.split(this.delimiter):e.slice(),n=u.call(this,null,t,this.listenerTree,0);for(var r=0;r<n.length;r++){var s=n[r];s._listeners=null}}else{if(!this._events[e])return this;this._events[e]=null}return this},o.prototype.listeners=function(e){if(this.wildcard){var t=[],r=typeof e=="string"?e.split(this.delimiter):e.slice();return u.call(this,t,r,this.listenerTree,0),t}return this._events||i.call(this),this._events[e]||(this._events[e]=[]),n(this._events[e])||(this._events[e]=[this._events[e]]),this._events[e]},o.prototype.listenersAny=function(){return this._all?this._all:[]},typeof define=="function"&&define.amd?define(function(){return o}):e.EventEmitter2=o}(typeof process!="undefined"&&typeof process.title!="undefined"&&typeof exports!="undefined"?exports:window),function(e,t){typeof define=="function"&&define.amd?define(["eventemitter2"],t):e.ROS=t(e.EventEmitter2)}(this,function(e){var t=function(t){function r(e){n.emit("connection",e)}function i(e){n.emit("close",e)}function s(e){n.emit("error",e)}function o(e,t){var n=new Image;n.onload=function(){var e=document.createElement("canvas"),r=e.getContext("2d");e.width=n.width,e.height=n.height,r.drawImage(n,0,0);var i=r.getImageData(0,0,n.width,n.height).data,s="";for(var o=0;o<i.length;o+=4)s+=String.fromCharCode(i[o],i[o+1],i[o+2]);var u=JSON.parse(s);t(u)},n.src="data:image/png;base64,"+e.data}function u(e){function t(e){e.op==="publish"?n.emit(e.topic,e.msg):e.op==="service_response"&&n.emit(e.id,e.values)}var r=JSON.parse(e.data);r.op==="png"?o(r,function(e){t(e)}):t(r)}function a(e){var t=JSON.stringify(e);n.socket.readyState!==WebSocket.OPEN?n.once("connection",function(){n.socket.send(t)}):n.socket.send(t)}var n=this;n.socket=null,n.idCounter=0,n.connect=function(e){n.socket=new WebSocket(e),n.socket.onopen=r,n.socket.onclose=i,n.socket.onerror=s,n.socket.onmessage=u},n.close=function(){n.socket&&n.socket.close()},t&&n.connect(t),n.getTopics=function(e){var t=new n.Service({name:"/rosapi/topics",serviceType:"rosapi/Topics"}),r=new n.ServiceRequest;t.callService(r,function(t){e(t.topics)})},n.Message=function(e){var t=this;e&&Object.keys(e).forEach(function(n){t[n]=e[n]})},n.Topic=function(e){var t=this;e=e||{},t.node=e.node,t.name=e.name,t.messageType=e.messageType,t.isAdvertised=!1,t.compression=e.compression||"none",t.compression&&t.compression!=="png"&&t.compression!=="none"&&t.emit("warning",t.compression+" compression is not supported. No comression will be used."),t.subscribe=function(e){t.on("message",function(t){e(t)}),n.on(t.name,function(e){var r=new n.Message(e);t.emit("message",r)}),n.idCounter++;var r="subscribe:"+t.name+":"+n.idCounter,i={op:"subscribe",id:r,type:t.messageType,topic:t.name,compression:t.compression};a(i)},t.unsubscribe=function(){n.removeAllListeners([t.name]),n.idCounter++;var e="unsubscribe:"+t.name+":"+n.idCounter,r={op:"unsubscribe",id:e,topic:t.name};a(r)},t.advertise=function(){n.idCounter++;var e="advertise:"+t.name+":"+n.idCounter,r={op:"advertise",id:e,type:t.messageType,topic:t.name};a(r),t.isAdvertised=!0},t.unadvertise=function(){n.idCounter++;var e="unadvertise:"+t.name+":"+n.idCounter,r={op:"unadvertise",id:e,topic:t.name};a(r),t.isAdvertised=!1},t.publish=function(e){t.isAdvertised||t.advertise(),n.idCounter++;var r="publish:"+t.name+":"+n.idCounter,i={op:"publish",id:r,topic:t.name,msg:e};a(i)}},n.Topic.prototype.__proto__=e.prototype,n.getServices=function(e){var t=new n.Service({name:"/rosapi/services",serviceType:"rosapi/Services"}),r=new n.ServiceRequest;t.callService(r,function(t){e(t.services)})},n.ServiceRequest=function(e){var t=this;e&&Object.keys(e).forEach(function(n){t[n]=e[n]})},n.ServiceResponse=function(e){var t=this;e&&Object.keys(e).forEach(function(n){t[n]=e[n]})},n.Service=function(e){var t=this;e=e||{},t.name=e.name,t.serviceType=e.serviceType,t.callService=function(e,r){n.idCounter++,serviceCallId="call_service:"+t.name+":"+n.idCounter,n.once(serviceCallId,function(e){var t=new n.ServiceResponse(e);r(t)});var i=[];Object.keys(e).forEach(function(t){i.push(e[t])});var s={op:"call_service",id:serviceCallId,service:t.name,args:i};a(s)}},n.Service.prototype.__proto__=e.prototype,n.getParams=function(e){var t=new n.Service({name:"/rosapi/get_param_names",serviceType:"rosapi/GetParamNames"}),r=new n.ServiceRequest;t.callService(r,function(t){e(t.names)})},n.Param=function(e){var t=this;e=e||{},t.name=e.name,t.get=function(e){var r=new n.Service({name:"/rosapi/get_param",serviceType:"rosapi/GetParam"}),i=new n.ServiceRequest({name:t.name,value:JSON.stringify("")});r.callService(i,function(t){var n=JSON.parse(t.value);e(n)})},t.set=function(e){var r=new n.Service({name:"/rosapi/set_param",serviceType:"rosapi/SetParam"}),i=new n.ServiceRequest({name:t.name,value:JSON.stringify(e)});r.callService(i,function(){})}},n.Param.prototype.__proto__=e.prototype};return t.prototype.__proto__=e.prototype,t});